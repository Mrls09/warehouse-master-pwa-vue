import{n,s as l}from"./index.86e6aef6.js";import{g as d}from"./ServicesServices.fb4cee89.js";const u={name:"CardService",props:{product:{type:Object,required:!0,default:()=>({name:"Producto desconocido",price:0,supplier:{name:"No especificado"},category:{name:"No especificada"},description:"Sin descripci\xF3n",qrCode:""})}},data(){return{loading:!1,snackbar:{visible:!1,message:"",color:""},dialog:!1}},methods:{showDetails(){this.dialog=!0},async agregarProducto(){var r,e;this.loading=!0;try{const t={_id:this.product.uid,name:this.product.name,price:this.product.price,description:this.product.description,qrCode:this.product.qrCode,supplier:((r=this.product.supplier)==null?void 0:r.name)||"No especificado",category:((e=this.product.category)==null?void 0:e.name)||"No especificada",quantity:1};try{const a=await window.dbCarrito.get(t._id);t._rev=a._rev,t.quantity=a.quantity+1,await window.dbCarrito.put(t),this.showNotification("success","El producto ya estaba en el carrito. Cantidad actualizada.")}catch(a){if(a.name==="not_found")await window.dbCarrito.put(t),this.showNotification("success","Producto agregado al carrito.");else throw a}}catch(t){t.status===409?(console.error("Conflicto al actualizar el documento. Intentando resolver..."),this.showNotification("error","Conflicto al actualizar el producto.")):(console.error("Error al agregar el producto al carrito:",t),this.showNotification("error","Error al agregar el producto al carrito."))}finally{this.loading=!1}},showNotification(r,e){this.snackbar.message=e,this.snackbar.color=r==="success"?"green":"red",this.snackbar.visible=!0},formatPrice(r){return r?r.toFixed(2):"0.00"}}};var p=function(){var a,s,o,c;var e=this,t=e._self._c;return t("v-card",{staticClass:"mx-auto my-4 card",attrs:{loading:e.loading,"max-width":"300"},scopedSlots:e._u([{key:"progress",fn:function(){return[t("v-progress-linear",{attrs:{color:"blue",height:"10",indeterminate:""}})]},proxy:!0}])},[t("v-img",{staticClass:"product-image",attrs:{src:e.product.qrCode,height:"auto",alt:"Imagen del producto"}}),t("v-card-title",{staticClass:"text-h6"},[e._v(e._s(e.product.name))]),t("v-card-text",[t("div",{staticClass:"my-2"},[t("strong",[e._v("Precio:")]),e._v(" $"+e._s(e.formatPrice(e.product.price))+" ")]),t("div",{staticClass:"my-2"},[t("strong",[e._v("Proveedor:")]),e._v(" "+e._s(((a=e.product.supplier)==null?void 0:a.name)||"No especificado")+" ")]),t("div",{staticClass:"my-2"},[t("strong",[e._v("Categor\xEDa:")]),e._v(" "+e._s(((s=e.product.category)==null?void 0:s.name)||"No especificada")+" ")])]),t("v-card-actions",[t("v-btn",{staticClass:"custom-btn",attrs:{color:"deep-purple lighten-2",text:""},on:{click:e.showDetails}},[e._v("Ver detalles")]),t("v-btn",{staticClass:"custom-btn",attrs:{color:"deep-purple lighten-2",text:""},on:{click:e.agregarProducto}},[e._v("Agregar al carrito")])],1),t("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.dialog,callback:function(i){e.dialog=i},expression:"dialog"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v(e._s(e.product.name))]),t("v-card-text",{staticClass:"d-flex flex-column align-center"},[t("v-img",{staticClass:"product-image-modal",attrs:{src:e.product.qrCode,"max-width":"200",alt:"Imagen del producto"}}),t("div",{staticClass:"info-modal mt-4"},[t("div",{staticClass:"my-2"},[t("strong",[e._v("Precio:")]),e._v(" $"+e._s(e.formatPrice(e.product.price))+" ")]),t("div",{staticClass:"my-2"},[t("strong",[e._v("Proveedor:")]),e._v(" "+e._s(((o=e.product.supplier)==null?void 0:o.name)||"No especificado")+" ")]),t("div",{staticClass:"my-2"},[t("strong",[e._v("Categor\xEDa:")]),e._v(" "+e._s(((c=e.product.category)==null?void 0:c.name)||"No especificada")+" ")]),t("div",{staticClass:"my-2"},[t("strong",[e._v("Descripci\xF3n:")]),e._v(" "+e._s(e.product.description||"Sin descripci\xF3n")+" ")])])],1),t("v-card-actions",[t("v-btn",{staticClass:"custom-btn",attrs:{color:"green",text:""},on:{click:function(i){e.dialog=!1}}},[e._v("Cerrar")])],1)],1)],1),t("v-snackbar",{attrs:{color:e.snackbar.color,timeout:"3000"},model:{value:e.snackbar.visible,callback:function(i){e.$set(e.snackbar,"visible",i)},expression:"snackbar.visible"}},[e._v(" "+e._s(e.snackbar.message)+" ")])],1)},v=[],g=n(u,p,v,!1,null,"de57ba6c",null,null);const h=g.exports;const m={components:{CardService:h},data(){return{services:[],filteredServices:[],loading:!1,currentPage:1,itemsPerPage:20,searchQuery:"",sortOrder:"",sortOptions:[{text:"De la A a la Z",value:"alphaAsc"},{text:"De la Z a la A",value:"alphaDesc"},{text:"Mayor a Menor Precio",value:"priceDesc"},{text:"Menor a Mayor Precio",value:"priceAsc"}]}},computed:{totalPages(){return Math.ceil(this.filteredServices.length/this.itemsPerPage)},paginatedServices(){const r=(this.currentPage-1)*this.itemsPerPage,e=r+this.itemsPerPage;return this.filteredServices.slice(r,e)}},methods:{async fetchServices(){this.loading=!0;try{const r=await d();Array.isArray(r)?(this.services=r.map(e=>({...e,_id:e._id?e._id.toString():Math.random().toString(36).substring(2)})),this.cacheProducts(this.services)):(console.warn("Formato inesperado en los datos:",r),await this.loadCachedProducts())}catch(r){console.error("Error al obtener servicios:",r),await this.loadCachedProducts()}finally{this.filterServices(),this.loading=!1}},async cacheProducts(r){try{await window.dbProductos.bulkDocs(r),console.log("Productos cacheados correctamente")}catch(e){console.error("Error cacheando productos:",e)}},async loadCachedProducts(){try{const r=await window.dbProductos.allDocs({include_docs:!0});this.services=r.rows.map(e=>e.doc),l("warning","Mostrando productos desde cach\xE9")}catch(r){console.error("Error cargando productos desde cach\xE9:",r),this.services=[]}},filterServices(){let r=this.services;this.searchQuery.trim()&&(r=r.filter(e=>e.name.toLowerCase().includes(this.searchQuery.toLowerCase()))),this.sortOrder==="alphaAsc"?r=r.sort((e,t)=>e.name.localeCompare(t.name)):this.sortOrder==="alphaDesc"?r=r.sort((e,t)=>t.name.localeCompare(e.name)):this.sortOrder==="priceDesc"?r=r.sort((e,t)=>t.price-e.price):this.sortOrder==="priceAsc"&&(r=r.sort((e,t)=>e.price-t.price)),this.filteredServices=r,this.currentPage=1},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},prevPage(){this.currentPage>1&&this.currentPage--}},mounted(){this.fetchServices()}};var _=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"filters-container"},[t("v-select",{staticClass:"sort-select",staticStyle:{"margin-top":"27px","margin-right":"10px"},attrs:{items:e.sortOptions,label:"Ordenar por","item-text":"text","item-value":"value"},on:{input:e.filterServices},model:{value:e.sortOrder,callback:function(a){e.sortOrder=a},expression:"sortOrder"}}),t("v-text-field",{staticClass:"search-input",attrs:{label:"Buscar producto","append-icon":"mdi-magnify","single-line":"","hide-details":""},on:{input:e.filterServices},model:{value:e.searchQuery,callback:function(a){e.searchQuery=a},expression:"searchQuery"}})],1),t("div",{staticClass:"card-container row"},[e.loading?t("v-progress-linear",{attrs:{color:"blue darken-2",height:"5",indeterminate:""}}):e._e(),e._l(e.paginatedServices,function(a,s){return t("div",{key:s,staticClass:"card-item col-lg-3 col-md-4 col-sm-6 col-12 mb-4"},[t("CardService",{attrs:{product:a}})],1)})],2),t("div",{staticClass:"pagination"},[t("button",{staticClass:"pagination-button custom-btn",class:{disabled:e.currentPage===1},attrs:{disabled:e.currentPage===1},on:{click:e.prevPage}},[t("i",{staticClass:"fa fa-chevron-left"}),e._v(" Prev ")]),t("span",{staticClass:"page-info"},[e._v("Page "+e._s(e.currentPage)+" of "+e._s(e.totalPages))]),t("button",{staticClass:"pagination-button custom-btn",class:{disabled:e.currentPage===e.totalPages},attrs:{disabled:e.currentPage===e.totalPages},on:{click:e.nextPage}},[e._v(" Next "),t("i",{staticClass:"fa fa-chevron-right"})])])])},f=[],C=n(m,_,f,!1,null,"82e04110",null,null);const y=C.exports;export{y as default};

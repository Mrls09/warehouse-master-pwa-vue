import{a as o}from"./ServicesServices.fb4cee89.js";import{n as i,s as r}from"./index.86e6aef6.js";const n={data(){return{data:[],selectedMovement:null,loading:!1}},async mounted(){await this.loadMovements()},methods:{async loadMovements(){this.loading=!0;try{const s=await o();Array.isArray(s)?(this.data=s.sort((t,e)=>new Date(e.lastModified)-new Date(t.lastModified)),this.cacheMovements(this.data)):(console.warn("Formato inesperado en los datos:",s),await this.loadCachedMovements())}catch(s){console.error("Error al cargar los movimientos:",s),await this.loadCachedMovements()}finally{this.loading=!1}},async cacheMovements(s){try{await window.dbMovimientos.bulkDocs(s),console.log("Movimientos cacheados correctamente")}catch(t){console.error("Error cacheando movimientos:",t)}},async loadCachedMovements(){try{const s=await window.dbMovimientos.allDocs({include_docs:!0});this.data=s.rows.map(t=>t.doc),this.data.sort((t,e)=>t.lastModified?e.lastModified?new Date(e.lastModified)-new Date(t.lastModified):1:-1),r("warning","Mostrando movimientos desde cach\xE9")}catch(s){console.error("Error cargando movimientos desde cach\xE9:",s),this.data=[]}finally{this.loading=!1}},openModal(s){this.selectedMovement=s,document.body.style.overflow="hidden"},closeModal(){this.selectedMovement=null,document.body.style.overflow=""},formatDate(s){return new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},calculateTotal(){return this.selectedMovement?this.selectedMovement.products.reduce((s,t)=>s+t.product.price*t.quantity,0):0}}};var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-6 bg-gray-50 min-h-screen"},[e("h1",{staticClass:"text-3xl text-center font-extrabold text-gray-900 mb-8"},[t._v("Tus Compras")]),t.loading?e("v-progress-linear",{attrs:{color:"blue darken-2",height:"5",indeterminate:""}}):t._e(),t.data.length?e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},t._l(t.data,function(a){return e("div",{key:a.uid,staticClass:"bg-white shadow-md rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-shadow duration-300"},[e("div",[e("div",{staticClass:"flex items-center justify-between"},[e("h2",{staticClass:"text-lg font-bold text-gray-800"},[t._v("\xDAltima Modificaci\xF3n")]),e("p",{staticClass:"text-sm text-gray-500"},[t._v(t._s(a.lastModified?t.formatDate(a.lastModified):"Pendiente de enviar al servidor"))])]),e("div",{staticClass:"flex items-center justify-between mt-2"},[e("span",{staticClass:"flex items-center text-sm text-gray-700"},[e("svg",{staticClass:"h-5 w-5 mr-1",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"}})]),t._v(" "+t._s(a.products?`${a.products.length} productos`:"Sin productos")+" ")])])]),e("button",{staticClass:"custom-btn mt-4 bg-indigo-600 text-white text-sm font-medium px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center",on:{click:function(m){return t.openModal(a)}}},[t._v(" Ver Detalles ")])])}),0):e("div",{staticClass:"flex justify-center items-center h-64"},[e("p",{staticClass:"text-lg text-gray-600"},[t._v("No has realizado ninguna compra todav\xEDa.")])]),e("transition",{attrs:{name:"fade"}},[t.selectedMovement?e("div",{staticClass:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"},[e("div",{staticClass:"bg-white rounded-lg shadow-lg w-11/12 max-w-3xl mx-auto p-6 relative"},[e("div",{staticClass:"flex justify-between items-center border-b pb-3"},[e("h2",{staticClass:"text-2xl font-bold text-gray-800"},[t._v("Detalles de la Compra")]),e("button",{staticClass:"text-gray-600 hover:text-gray-800 transition-colors duration-200",on:{click:t.closeModal}},[e("svg",{staticClass:"h-6 w-6",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}})])])]),e("div",{staticClass:"mt-4"},[e("h3",{staticClass:"text-lg font-semibold text-gray-800 mb-2"},[t._v("Observaciones:")]),e("p",{staticClass:"text-sm text-gray-500"},[t._v(" "+t._s(t.selectedMovement.observations||"Sin comentarios")+" ")]),e("div",{staticClass:"border-t my-4"}),e("h4",{staticClass:"text-md font-semibold text-gray-800 mb-2"},[t._v("Productos:")]),e("div",{staticClass:"overflow-y-auto max-h-80"},[e("ul",t._l(t.selectedMovement.products,function(a){return e("li",{key:a.uid,staticClass:"mb-4"},[e("p",[e("strong",[t._v("Nombre:")]),t._v(" "+t._s(a.product.name))]),e("p",[e("strong",[t._v("Precio:")]),t._v(" $"+t._s(a.product.price))]),e("p",[e("strong",[t._v("Proveedor:")]),t._v(" "+t._s(a.product.supplier.name))]),e("p",[e("strong",[t._v("Cantidad:")]),t._v(" "+t._s(a.quantity))]),e("p",[e("strong",[t._v("Expira el:")]),t._v(" "+t._s(new Date(a.product.expirationDate).toLocaleDateString()))]),e("div",{staticClass:"border-t my-4"})])}),0)])]),e("div",{staticClass:"flex justify-between items-center mt-6"},[e("span",{staticClass:"font-semibold text-gray-800"},[t._v("Total: $"+t._s(t.calculateTotal().toFixed(2)))]),e("button",{staticClass:"custom-btn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300",on:{click:t.closeModal}},[t._v(" Aceptar ")])])])]):t._e()])],1)},d=[],c=i(n,l,d,!1,null,"46f7f1b9",null,null);const g=c.exports;export{g as default};

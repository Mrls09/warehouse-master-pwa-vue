import{n as o}from"./index.da889d62.js";import{g as i}from"./ServicesServices.7d9d50dd.js";const c={name:"CardService",props:{product:{type:Object,required:!0,default:()=>({name:"Producto desconocido",price:0,supplier:{name:"No especificado"},category:{name:"No especificada"},description:"Sin descripci\xF3n",qrCode:""})}},data(){return{loading:!1,snackbar:{visible:!1,message:"",color:""}}},methods:{async agregarProducto(){this.loading=!0;try{const t={_id:this.product.uid,name:this.product.name,price:this.product.price,description:this.product.description,qrCode:this.product.qrCode,supplier:this.product.supplier?.name||"No especificado",category:this.product.category?.name||"No especificada",quantity:1};try{const e=await window.dbCarrito.get(t._id);t._rev=e._rev,t.quantity=e.quantity+1,await window.dbCarrito.put(t),this.showNotification("success","El producto ya estaba en el carrito. Cantidad actualizada.")}catch(e){if(e.name==="not_found")await window.dbCarrito.put(t),this.showNotification("success","Producto agregado al carrito.");else throw e}}catch(t){t.status===409?(console.error("Conflicto al actualizar el documento. Intentando resolver..."),this.showNotification("error","Conflicto al actualizar el producto.")):(console.error("Error al agregar el producto al carrito:",t),this.showNotification("error","Error al agregar el producto al carrito."))}finally{this.loading=!1}},showNotification(t,e){this.snackbar.message=e,this.snackbar.color=t==="success"?"green":"red",this.snackbar.visible=!0},formatPrice(t){return t?t.toFixed(2):"0.00"},showElementos(){}}};var n=function(){var e=this,r=e._self._c;return r("v-card",{staticClass:"mx-auto my-4 animate__animated animate__rubberBand",attrs:{loading:e.loading,"max-width":"300"},scopedSlots:e._u([{key:"progress",fn:function(){return[r("v-progress-linear",{attrs:{color:"blue",height:"10",indeterminate:""}})]},proxy:!0}])},[r("v-img",{attrs:{src:e.product.qrCode,height:"auto",alt:"Imagen del producto"}}),r("v-card-title",{staticClass:"text-h6"},[e._v(e._s(e.product.name))]),r("v-card-text",[r("div",{staticClass:"my-2 font-weight-black"},[r("strong",[e._v("Precio:")]),e._v(" $"+e._s(e.formatPrice(e.product.price))+" ")]),r("div",{staticClass:"my-2 text-caption"},[r("strong",[e._v("Proveedor:")]),e._v(" "+e._s(e.product.supplier?.name||"No especificado")+" ")]),r("div",{staticClass:"my-2 text-caption"},[r("strong",[e._v("Categor\xEDa:")]),e._v(" "+e._s(e.product.category?.name||"No especificada")+" ")]),r("div",{staticClass:"text-caption"},[r("strong",[e._v("Descripci\xF3n:")]),e._v(" "+e._s(e.product.description||"Sin descripci\xF3n")+" ")])]),r("v-divider",{staticClass:"mx-2"}),r("v-btn",{attrs:{color:"deep-purple lighten-2",text:""},on:{click:e.showElementos}},[e._v(" Ver elementos del paquete ")]),r("v-card-actions",[r("v-btn",{attrs:{color:"deep-purple lighten-2",text:""},on:{click:e.agregarProducto}},[e._v(" Agregar al carrito ")])],1),r("v-snackbar",{attrs:{color:e.snackbar.color,timeout:"3000"},model:{value:e.snackbar.visible,callback:function(a){e.$set(e.snackbar,"visible",a)},expression:"snackbar.visible"}},[e._v(" "+e._s(e.snackbar.message)+" ")])],1)},d=[],l=o(c,n,d,!1,null,"2af17648",null,null);const u=l.exports;const p={components:{CardService:u},data(){return{services:[],loading:!1}},methods:{async fetchServices(){this.loading=!0;try{const t=await i();Array.isArray(t)?(this.services=t,this.filteredServices=[...this.services]):(console.warn("Formato inesperado en los datos:",t),this.services=[],this.filteredServices=[])}catch(t){console.error("Error al obtener servicios:",t),this.services=[],this.filteredServices=[]}finally{this.loading=!1}}},mounted(){this.fetchServices()}};var _=function(){var e=this,r=e._self._c;return r("div",[r("div",{staticClass:"card-container row"},[e.loading?r("v-progress-linear",{attrs:{color:"blue darken-2",height:"5",indeterminate:""}}):e._e(),e._l(e.services,function(a,s){return r("div",{key:s,staticClass:"card-item col-lg-3 col-md-4 col-sm-6 col-12 mb-4"},[r("CardService",{attrs:{product:a}})],1)})],2)])},v=[],m=o(p,_,v,!1,null,"de66c8f4",null,null);const g=m.exports;export{g as default};

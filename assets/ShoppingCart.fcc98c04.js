import{n as C,a as h,r as y,o as b,u as _,s as l}from"./index.c7a34043.js";import{c as f}from"./ServicesServices.3bd78176.js";const k={name:"ShoppingCart",setup(){const n=h({products:[],total:0}),r=y(""),t=()=>{n.total=n.products.reduce((o,e)=>o+e.product.price*e.quantity,0)},a=async()=>{try{const o=await window.dbCarrito.allDocs({include_docs:!0});n.products=o.rows.map(e=>({product:e.doc,quantity:e.doc.quantity||1})),t()}catch(o){console.error("Error al cargar el carrito:",o)}},u=async o=>{const e=n.products.find(s=>s.product._id===o);e&&(e.quantity+=1,e.product.quantity=e.quantity,console.log(e),await window.dbCarrito.put(e.product),t())},c=async o=>{const e=n.products.find(s=>s.product._id===o);e&&e.quantity>1?(e.quantity-=1,e.product.quantity=e.quantity,await window.dbCarrito.put(e.product),t()):e&&await v(o)},v=async o=>{const e=n.products.findIndex(s=>s.product._id===o);e!==-1&&(await window.dbCarrito.remove(n.products[e].product),n.products.splice(e,1),t())},p=async()=>{try{const e=(await window.dbCarrito.allDocs()).rows.map(s=>window.dbCarrito.remove(s.id,s.value.rev));await Promise.all(e),n.products=[],t()}catch(o){console.error("Error al vaciar el carrito:",o)}},m=async()=>{const{user:o}=_();if(!!!(o!=null&&o.token)){l("warning","Inicia sesi\xF3n para proceder con tu compra.");return}if(n.products.length===0){l("warning","El carrito est\xE1 vac\xEDo.");return}const s={products:n.products.map(i=>({product:{uid:i.product._id},quantity:i.quantity})),status:"EXIT",observations:r.value};try{await f(s)?await p():(await g(s),l("warning","Sin conexi\xF3n. La orden se guardar\xE1 para env\xEDo posterior."),p())}catch(i){console.error("Error en comprarCart:",i),await g(s),l("error","Error al procesar la compra. Intenta de nuevo.")}},g=async o=>{try{const e={_id:new Date().toISOString(),payload:o,sent:!1};await window.dbComprarCarrito.put(e),await window.dbMovimientos.put({...o,_id:e._id})}catch(e){console.error("Error al guardar la orden offline:",e)}};let w=!1;const x=async()=>{if(!w){w=!0;try{const e=(await window.dbComprarCarrito.allDocs({include_docs:!0})).rows.filter(s=>!s.doc.sent&&!s.doc.sending);for(const s of e)try{s.doc.sending=!0,await window.dbComprarCarrito.put(s.doc),await f(s.doc.payload)&&(await window.dbComprarCarrito.remove(s.doc._id,s.doc._rev),console.log("Orden enviada y eliminada correctamente:",s.doc._id))}catch(i){console.error("Error al procesar la orden:",i,"ID:",s.doc._id)}}catch(o){console.error("Error al procesar \xF3rdenes pendientes:",o)}finally{w=!1}}},d=async()=>{navigator.onLine&&await x()};return b(()=>{a(),d(),window.removeEventListener("online",d),window.addEventListener("online",d)}),window.addEventListener("online",d),{cart:n,observations:r,incrementQuantity:u,decrementQuantity:c,removeProduct:v,clearCart:p,comprarCart:m}}};var q=function(){var r=this,t=r._self._c;return t("div",{staticClass:"shopping-cart max-w-2xl mx-auto p-6 bg-white shadow-lg rounded-xl"},[t("div",{staticClass:"flex items-center justify-center mb-6"},[t("svg",{staticClass:"h-8 w-8 mr-3 text-blue-600",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"}})]),t("h1",{staticClass:"text-3xl font-bold text-gray-800"},[r._v("Carrito de Compras")])]),r.cart.products.length===0?t("div",{staticClass:"text-center py-10 bg-gray-100 rounded-lg"},[t("p",{staticClass:"text-gray-500 text-xl"},[r._v("El carrito est\xE1 vac\xEDo")])]):t("div",{staticClass:"space-y-4"},r._l(r.cart.products,function(a,u){return t("div",{key:u,staticClass:"flex items-center bg-gray-50 p-4 rounded-lg shadow-sm hover:shadow-md transition-all duration-300"},[t("div",{staticClass:"w-24 h-24 mr-4 flex-shrink-0"},[t("img",{staticClass:"w-full h-full object-cover rounded-md",attrs:{src:a.product.qrCode,alt:"Product QR"}})]),t("div",{staticClass:"flex-grow"},[t("h3",{staticClass:"text-xl font-semibold text-gray-800"},[r._v(" "+r._s(a.product.name)+" ")]),t("p",{staticClass:"text-gray-600"},[r._v(" Proveedor: "+r._s(a.product.provider)+" ")]),t("p",{staticClass:"text-gray-500 text-sm"},[r._v(" "+r._s(a.product.description)+" ")])]),t("div",{staticClass:"flex flex-col items-end space-y-2"},[t("div",{staticClass:"flex items-center space-x-2"},[t("button",{staticClass:"bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition",on:{click:function(c){return r.decrementQuantity(a.product._id)}}},[t("svg",{staticClass:"h-4 w-4",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"}})])]),t("span",{staticClass:"font-bold text-gray-700"},[r._v(" "+r._s(a.quantity)+" ")]),t("button",{staticClass:"bg-green-100 text-green-600 rounded-full p-1 hover:bg-green-200 transition",on:{click:function(c){return r.incrementQuantity(a.product._id)}}},[t("svg",{staticClass:"h-4 w-4",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"}})])])]),t("div",{staticClass:"flex items-center space-x-2"},[t("p",{staticClass:"font-semibold text-blue-600"},[r._v(" $"+r._s((a.product.price*a.quantity).toFixed(2))+" ")]),t("button",{staticClass:"text-red-500 hover:text-red-700 transition",on:{click:function(c){return r.removeProduct(a.product._id)}}},[t("svg",{staticClass:"h-5 w-5",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}})])])])])])}),0),t("div",{staticClass:"mt-6 bg-gray-100 p-4 rounded-lg"},[t("div",{staticClass:"flex justify-between items-center mb-4"},[t("span",{staticClass:"text-xl font-bold text-gray-800"},[r._v("Total:")]),t("span",{staticClass:"text-2xl font-bold text-blue-600"},[r._v(" $"+r._s(r.cart.total.toFixed(2))+" ")])]),r.cart.products.length>0?t("div",{staticClass:"mt-4"},[t("label",{staticClass:"block text-gray-700 font-semibold mb-2",attrs:{for:"observations"}},[r._v(" Observaciones ")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:r.observations,expression:"observations"}],staticClass:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 transition",attrs:{id:"observations",rows:"4",placeholder:"Puedes escribir referencias, instrucciones o comentarios adicionales aqu\xED."},domProps:{value:r.observations},on:{input:function(a){a.target.composing||(r.observations=a.target.value)}}})]):r._e(),t("div",{staticClass:"flex justify-between mt-6 space-x-4"},[t("button",{staticClass:"flex-grow bg-red-100 text-red-600 py-2 rounded-lg hover:bg-red-200 transition flex items-center justify-center",on:{click:r.clearCart}},[t("svg",{staticClass:"h-5 w-5 mr-2",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}})]),r._v(" Vaciar carrito ")]),t("button",{staticClass:"flex-grow bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition flex items-center justify-center",on:{click:r.comprarCart}},[t("svg",{staticClass:"h-5 w-5 mr-2",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[t("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"}})]),r._v(" Comprar ")])])])])},M=[],E=C(k,q,M,!1,null,"a5e13619",null,null);const L=E.exports;export{L as default};

import{n as r,u as i,s}from"./index.86e6aef6.js";const n={data(){return{usuario:{name:"",email:""},editDialog:!1,newName:"",handleOnlineListener:null}},methods:{async signOut(){i().logout()},async getUserData(){let a=localStorage.getItem("user");if(a)try{a=JSON.parse(a),console.log("UID:",a.uid),this.usuario=a}catch(t){console.error("Error al obtener uid:",t)}else console.log("Usuario no encontrado en localStorage")},editName(){this.newName=this.usuario.name,this.editDialog=!0},async saveName(){if(this.newName.trim()!==""){this.usuario.name=this.newName,this.editDialog=!1;const a={...this.usuario,name:this.newName};if(navigator.onLine)try{await i().updateUserData(a)}catch(t){console.error("Error al actualizar el nombre:",t),s("error","No se pudo actualizar el nombre")}else try{const t={_id:new Date().toISOString(),payload:a,sent:!1};await window.dbNombreUpdate.put(t),s("warning","Sin conexi\xF3n. Los cambios se enviar\xE1n autom\xE1ticamente cuando vuelvas a estar en l\xEDnea.")}catch(t){console.error("Error al guardar la petici\xF3n localmente:",t),s("error","No se pudo guardar la petici\xF3n localmente")}}},async sendPendingNameUpdates(){try{const t=(await window.dbNombreUpdate.allDocs({include_docs:!0})).rows.filter(e=>!e.doc.sent);for(const e of t)try{await i().updateUserData(e.doc.payload),await window.dbNombreUpdate.remove(e.doc),console.log("Cambio pendiente procesado y eliminado:",e.doc._id)}catch(o){console.error("Error al enviar la petici\xF3n pendiente:",o)}}catch(a){console.error("Error al procesar peticiones pendientes:",a)}}},mounted(){this.getUserData(),navigator.onLine&&this.sendPendingNameUpdates();const a=async()=>{await this.sendPendingNameUpdates()};window.addEventListener("online",a),this.handleOnlineListener=a},beforeUnmount(){this.handleOnlineListener&&window.removeEventListener("online",this.handleOnlineListener)}};var l=function(){var t=this,e=t._self._c;return e("v-container",{staticClass:"py-12 d-flex justify-center"},[e("v-card",{staticClass:"mx-auto text-center",attrs:{elevation:"5","max-width":"600"}},[e("v-avatar",{staticClass:"mx-auto my-4",attrs:{size:"120"}},[e("img",{attrs:{src:"https://img.freepik.com/vector-premium/icono-circulo-usuario-anonimo-ilustracion-vector-estilo-plano-sombra_520826-1931.jpg",alt:"Avatar"}})]),e("v-card-title",{staticClass:"d-flex justify-center align-center"},[e("h2",{staticClass:"mb-0"},[t._v("Mi Perfil")])]),e("v-divider"),e("v-card-text",[e("v-row",{attrs:{dense:""}},[e("v-col",{attrs:{cols:"12"}},[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"font-weight-bold"},[t._v(" Nombre Completo: ")]),e("v-list-item-subtitle",[t._v(" "+t._s(t.usuario.name)+" "),e("v-btn",{staticClass:"ml-2",attrs:{icon:"",color:"blue"},on:{click:t.editName}},[e("v-icon",[t._v("mdi-pencil")])],1)],1)],1)],1)],1),e("v-col",{attrs:{cols:"12"}},[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"font-weight-bold"},[t._v(" Correo Electr\xF3nico: ")]),e("v-list-item-subtitle",[t._v(" "+t._s(t.usuario.email)+" ")])],1)],1)],1)],1),e("v-btn",{staticClass:"custom-btn",attrs:{color:"red",text:""},on:{click:t.signOut}},[e("v-icon",{attrs:{left:""}},[t._v("mdi-logout")]),t._v(" Cerrar Sesi\xF3n ")],1)],1),e("v-divider",{staticClass:"my-4"}),e("v-card-subtitle",{staticClass:"text-center"},[e("small",[t._v(" Tus datos en "),e("strong",[t._v("Warehouse")]),t._v(" son completamente privados y seguros. Respetamos tu privacidad en todo momento. ")])])],1),e("v-dialog",{attrs:{"max-width":"500px"},model:{value:t.editDialog,callback:function(o){t.editDialog=o},expression:"editDialog"}},[e("v-card",[e("v-card-title",{staticClass:"headline"},[t._v("Editar Nombre")]),e("v-card-text",[e("v-text-field",{attrs:{label:"Nuevo Nombre",outlined:"",autofocus:""},model:{value:t.newName,callback:function(o){t.newName=o},expression:"newName"}})],1),e("v-card-actions",[e("v-btn",{attrs:{text:""},on:{click:function(o){t.editDialog=!1}}},[t._v("Cancelar")]),e("v-btn",{attrs:{color:"primary"},on:{click:t.saveName}},[t._v("Guardar")])],1)],1)],1)],1)},c=[],d=r(n,l,c,!1,null,"98256a2c",null,null);const m=d.exports;export{m as default};

import{n as w,a as f,o as b,s as l}from"./index.da889d62.js";import{c as v}from"./ServicesServices.7d9d50dd.js";const g={name:"ShoppingCart",setup(){const n=f({products:[],total:0}),t=()=>{n.total=n.products.reduce((o,r)=>o+r.product.price*r.quantity,0)},a=async()=>{try{const o=await window.dbCarrito.allDocs({include_docs:!0});n.products=o.rows.map(r=>({product:r.doc,quantity:r.doc.quantity||1})),t()}catch(o){console.error("Error al cargar el carrito:",o)}},s=async o=>{const r=n.products.find(e=>e.product._id===o);r&&(r.quantity+=1,r.product.quantity=r.quantity,await window.dbCarrito.put(r.product),t())},i=async o=>{const r=n.products.find(e=>e.product._id===o);r&&r.quantity>1?(r.quantity-=1,r.product.quantity=r.quantity,await window.dbCarrito.put(r.product),t()):r&&await c(o)},c=async o=>{const r=n.products.findIndex(e=>e.product._id===o);r!==-1&&(await window.dbCarrito.remove(n.products[r].product),n.products.splice(r,1),t())},d=async()=>{try{const r=(await window.dbCarrito.allDocs()).rows.map(e=>window.dbCarrito.remove(e.id,e.value.rev));await Promise.all(r),n.products=[],t()}catch(o){console.error("Error al vaciar el carrito:",o)}},_=async()=>{if(n.products.length===0){l("warning","El carrito est\xE1 vac\xEDo.");return}const o={products:n.products.map(r=>({product:{uid:r.product._id},quantity:r.quantity})),status:"EXIT",observations:observations.value};try{await v(o)?await d():(await y(o),l("warning","Sin conexi\xF3n. La orden se guardar\xE1 para env\xEDo posterior."),d())}catch(r){console.error("Error en comprarCart:",r),l("error","Error al procesar la compra. Intenta de nuevo.")}},y=async o=>{try{const r={_id:new Date().toISOString(),payload:o,sent:!1};await window.dbComprarCarrito.put(r)}catch(r){console.error("Error al guardar la orden offline:",r)}},C=async()=>{try{const r=(await window.dbComprarCarrito.allDocs({include_docs:!0})).rows.filter(e=>!e.doc.sent);for(const e of r)try{if(await v(e.doc.payload))try{await window.dbComprarCarrito.remove(e.doc._id,e.doc._rev),console.log("Orden enviada correctamente:",e.doc._id)}catch(m){console.error("Error al eliminar la orden de la base de datos offline:",m,"ID:",e.doc._id)}}catch(p){console.error("Error al enviar orden:",p,"ID:",e.doc._id)}}catch(o){console.error("Error al procesar las \xF3rdenes pendientes:",o)}},u=async()=>{navigator.onLine&&await C()};return b(()=>{a(),u()}),window.addEventListener("online",u),{cart:n,incrementQuantity:s,decrementQuantity:i,removeProduct:c,clearCart:d,comprarCart:_}}};var q=function(){var t=this,a=t._self._c;return a("div",{staticClass:"shopping-cart"},[a("h1",{staticClass:"text-2xl text-center font-bold text-gray-800 mb-6"},[t._v(" Carrito de Compras ")]),t.cart.products.length===0?a("div",{staticClass:"empty-cart"},[a("p",[t._v("El carrito est\xE1 vac\xEDo.")])]):a("div",{staticClass:"cart-items"},[a("ul",t._l(t.cart.products,function(s,i){return a("li",{key:i,staticClass:"cart-item"},[a("div",{staticClass:"item-info"},[a("div",{staticClass:"product-name"},[a("h3",[t._v(t._s(s.product.name))]),a("p",[t._v("Proveedor: "+t._s(s.product.provider))])]),a("p",[t._v("Cantidad: "+t._s(s.quantity))]),a("p",[t._v("Precio: $"+t._s((s.product.price||0).toFixed(2)))]),a("p",[t._v(t._s(s.product.description))])]),a("div",{staticClass:"item-actions"},[a("div",{staticClass:"qr-code"},[a("img",{attrs:{src:s.product.qrCode,alt:"QR Code"}})]),a("div",{staticClass:"quantity-actions"},[a("button",{staticClass:"quantity-btn",on:{click:function(c){return t.incrementQuantity(s.product._id)}}},[t._v(" + ")]),a("span",{staticClass:"quantity-display"},[t._v(t._s(s.quantity))]),a("button",{staticClass:"quantity-btn",on:{click:function(c){return t.decrementQuantity(s.product._id)}}},[t._v(" - ")])]),a("button",{staticClass:"remove-btn",on:{click:function(c){return t.removeProduct(s.product._id)}}},[t._v(" Eliminar ")])])])}),0)]),a("div",{staticClass:"cart-total"},[a("p",[t._v("Total: $"+t._s(t.cart.total.toFixed(2)))])]),t.cart.products.length>0?a("div",{staticClass:"observations-section"},[a("label",{staticClass:"text-lg font-semibold text-gray-700",attrs:{for:"observations"}},[t._v("Observaciones:")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.observations,expression:"observations"}],staticClass:"observations-textarea",attrs:{id:"observations",rows:"4",placeholder:"Puedes escribir referencias, instrucciones o comentarios adicionales aqu\xED."},domProps:{value:t.observations},on:{input:function(s){s.target.composing||(t.observations=s.target.value)}}})]):t._e(),a("div",{staticClass:"quantity-actions"},[a("button",{staticClass:"clear-cart-btn",on:{click:t.clearCart}},[t._v("Vaciar carrito")]),a("br"),a("button",{staticClass:"comprar-cart-btn",on:{click:t.comprarCart}},[t._v("Comprar")])])])},h=[],x=w(g,q,h,!1,null,"112bb045",null,null);const D=x.exports;export{D as default};
